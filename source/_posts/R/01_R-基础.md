---
title: R语言基础
date: 2019-10-20
updated: 2019-10-20
tag:
- R
categories:
- R
---

R作为一种统计分析软件，是集统计分析与图形显示于一体的。

它可以运行于UNIX,Windows和Macintosh的操作系统上，而且嵌入了一个非常方便实用的帮助系统，相比于其他统计分析软件，R还有以下特点：

<!-- more -->

- R是自由软件。

  这意味着它是完全免费,开放源代码的。可以在它的网站及其镜像中下载任何有关的安装程序、源代码、程序包及其源代码、文档资料。标准的安装文件身自身就带有许多模块和内嵌统计函数,安装好后可以直接实现许多常用的统计功能。

- R是一种可编程的语言。

  作为一个开放的统计编程环境,语法通俗易懂,很容易学会和掌握语言的语法。而且学会之后,我们可以编制自己的函数来扩展现有的语言。这也就是为什么它的更新速度比一般统计软件,如,SPSS,SAS等快得多。大多数最新的统计方法和技术都可以在R中直接得到。 

- 所有R的函数和数据集是保存在程序包里面的。

  只有当一个包被载入时,它的内容才可以被访问。一些常用、基本的程序包已经被收入了标准安装文件中,随着新的统计分析方法的出现,标准安装文件中所包含的程序包也随着版本的更新而不断变化。在另外版安装文件中,已经包含的程序包有：base一R的基础模块、mle一极大似然估计模块、ts一时间序列分析模块、mva一多元统计分析模块、survival一生存分析模块等等. 

- R具有很强的互动性。

  除了图形输出是在另外的窗口处，它的输入输出窗口都是在同一个窗口进行的，输入语法中如果出现错误会马上在窗口口中得到提示,对以前输入过的命令有记忆功能,可以随时再现、编辑修改以满足用户的需要。输出的图形可以直接保存为JPG,BMP,PNG等图片格式,还可以直接保存为PDF文件。另外,和其他编程语言和数据库之间有很好的接口。

#### 数学运算

- 加

  ```R
  > 5+5
  [1] 10
  ```

- 减

  ```R
  > 5-5
  [1] 0
  ```

- 乘

  ```R
  > 3*5
  [1] 15
  ```

- 除

  ```R
  > (3+4)/2
  [1] 3.5
  ```

- 乘方

  ```R
  > 2^3
  [1] 8
  ```

- 取余

  ```R
  > (3+4)%%2
  [1] 1
  ```

#### 赋值

使用`<-`作为赋值号

`c()`可以把多个对象放在一起，组成向量

```R
> a<-123
> a
[1] 123
> l <- c(1,2)
> l
[1] 1 2
```

#### 使用帮助文档

| 函数                            | 功能                                       |
| ------------------------------- | ------------------------------------------ |
| help.start()                    | 打开帮助文档首页                           |
| help("foo")或?foo               | 查看函数foo的帮助                          |
| help.search("foo")或??foo       | 以foo为关键词搜索本地帮助文档              |
| example("foo")                  | 函数foo的使用示例                          |
| RSiteSearch("foo")              | 以foo为关键词搜索在线文档和邮件列表存档    |
| apropos("foo", mode="function") | 列出名称中含有foo的所有可用函数            |
| data()                          | 列出当前已加载包中所含的所有可用示例数据集 |
| vignette()                      | 列出当前已安装包中所有可用的vignette文档   |
| vignette("foo")                 | 为主题foo显示指定的vignette文档            |

#### 功能包

- `search()`：查看当前已加载的包
- `install.packages("dplyr")` 安装包
- `update.packages()` 更新包
- `library("dplyr")`载入包

#### 数据类型

- 数值型 numerics
- 逻辑判断 logical
- 字符型 characters
- 因子 factors

注：不同类型不能相加减

使用`class()`来判断数据类型

#### 常用函数

- `length(object)`：显示对象中元素/成分的数量

  ```R
  > a <- "My First List"
  > b <- c(25, 26, 18, 39)
  > c <- matrix(1:10, nrow=5)
  > d <- c("one", "two", "three")
  > length(a)
  [1] 1
  > length(d)
  [1] 3
  ```

- `dim(object)`：显示某个对象的维度

- `str(object)`：显示某个对象的结构

  ```R
  > str(mylist)
  List of 4
   $ title: chr "My First List"
   $      : num [1:4] 25 26 18 39
   $      : int [1:5, 1:2] 1 2 3 4 5 6 7 8 9 10
   $      : chr [1:3] "one" "two" "three"
  ```

- `class(object)`：显示某个对象的类或类型

- `mode`：显示某个对象的模式

- `names(object)`：显示某对象中各成分的名称

  ```R
  > names(mylist)
  [1] "title" ""      ""      ""  
  ```

- `c(object, object...)`：将对象合并入一个向量

- `cbind(object, object...)`：按列合对象

  ```R
  > students
  [1] "A" "B" "C" "D"
  > math_score
  [1] 100  80  70  95
  > cbind(students, math_score)
       students math_score
  [1,] "A"      "100"     
  [2,] "B"      "80"      
  [3,] "C"      "70"      
  [4,] "D"      "95"     
  ```

- `rbind(object, object...)`：按行合并对象

  ```R
  > rbind(students, math_score)
             [,1]  [,2] [,3] [,4]
  students   "A"   "B"  "C"  "D" 
  math_score "100" "80" "70" "95"
  ```

- `head(object)`：列出某个对象的开始部分

- `tail(object)`：列出某个对象的最后部分

- `ls()`：显示当前的对象列表

- `rm(object, object...)`：删除一个或更多个对象

  删除当前工作环境的所有对象

  ```R
  > rm(list=ls())
  > ls()
  character(0)
  ```
  
- `newobject <- edit(object)`：编辑对象并另存为newobject

- `fix(object)`：直接编辑对象

##### 统计

- `mean()`：均值

- `median()`：中位数

- `众数`

  R中未提供直接调用的函数

  `names(table(mtcars$mpg))[which.max(table(mtcars$mpg))]`

- `quantile()`百分位数

- `var()`：样本方差

- `range()`：极差

- `summary()`： 可以提供最小值、最大值、四分位数和数值型变量的均值，以及因子向量和逻辑型向量的频数统计 

- `sd()`：标准差

- `cor(object, object)`：线性关系，相关度

#### 工作空间

| 函数                            | 功能                                            |
| ------------------------------- | ----------------------------------------------- |
| getwd()                         | 显示当前的工作目录                              |
| setwd("myditectory")            | 修改当前的工作目录为mydirectory                 |
| ls()                            | 列出当前工作空间中的对象                        |
| rm(objectlist)                  | 移除（删除）一个或多个对象                      |
| help(options)                   | 显示可用选项的说明                              |
| options()                       | 显示或设置当前选项                              |
| history(#)                      | 显示最近使用过的#个命令（默认是25个）           |
| savehistory("myfile")           | 保存命令历史到文件myfile中（默认值为.Rhistory） |
| loadhistory("myfile")           | 载入一个命令历史文件（默认值为.Rhistory）       |
| save.image("myfile")            | 保存工作空间到文件myfile中（默认是.RData）      |
| save(objectlist, file="myfile") | 保存指定对象到一个文件中                        |
| load("myfile")                  | 读取一个工作空间到当前会话中（默认是.RData）    |
| q()                             | 退出R。将会询问你是否保存工作空间。             |

**注意：**

- `setwd()`命令的路径中使用正斜杠（/），R将反斜杠作为一个转义符。即使在windows平台上，路径也要使用正斜杠。
- `setwd()`不会自动创建一个不存在的目录，必要的话，使用`dir.create()`来创建新目录，然后使用setwd()将工作目录指向这个新目录

#### 输入和输出

##### 使用键盘输入数据

```
> mydata <- data.frame(age=numeric(0), gender=character(0), weight=numeric(0))
> mydata <- edit(mydata)
Warning message:
In edit.data.frame(mydata) : 在'gender'里加上了因子水准
> mydata
  age gender weight
1   2      3      2
2   2      2      2
3   1      2      1
```

##### 从带分隔符的文本文件中导入数据

可以使用`read.table()`

`mydata <- read.table(file, header=logical_value, sep="delimiter", row.names="name")`

```R
> grades <- read.table("studentsgrades.csv", header=TRUE, sep=",", row.names="STUDENTID")
> #从当前目录中读入了一个名为studentsgrades.csv的逗号分隔文件，从文件的第一行取得了各变量名称，将变量STUDENTID指定为行标识符，最后将结果保存到了名为grades的数据框中
```

**注意：** 参数sep可以为一个或多个的空格，制表符，换行符或回车符

默认情况下，字符型变量转换为因子。我们并不是总是希望程序这样做，可以设置选项`stringsAsFactors=FALSE`，这样将停止对所有字符型变量的此种转换；另一种方法是使用选项`colClasses`为每一列指定一个类。

##### 导入excel

可以使用`RODBC`包来访问Excel文件

```R
install.packages("RODBC")
library(RODBC)
channel <- odbcConnectExcel("myfile.xls")
mydataframe <- sqlFetch(channel, "mysheet")
odbcClose(channel)
```

xlsx包可以用来读取xlsx文件

```
library(xlsx)
workbook <- "c:/myworkbook.xlsx"
mydataframe <- read.xlsx(workbook, 1)
```

##### 访问数据库管理系统

- ODBC接口

  `install.packages("RODBC")`

  | 函数                                                       | 描述                                                  |
  | ---------------------------------------------------------- | ----------------------------------------------------- |
  | `odbcConnect(dsn, uid="", pwd="")`                         | 建立一个到ODBC数据库的连接                            |
  | `sqlFetch(channel, sqltable)`                              | 读取ODBC数据库中的表到一个数据框中                    |
  | `sqlQuery(channel, query)`                                 | 向ODBC数据库提交一个查询并返回结果                    |
  | `sqlSave(channel, mydf, tablename=sqltable, append=FALSE)` | 将数据框写入或更新(append=TRUE)到ODBC数据库的某个表中 |
  | `sqlDrop(channel, sqltable)`                               | 删除ODBC数据库中的某个表                              |
  | `close(channel)`                                           | 关闭连接                                              |

  `RODBC`包允许R和一个通过ODBC连接的SQL数据库之间进行双向通信。

  例：将数据库的两个表（Crime和Punishment）分别导入为R中的两个名为crimedat和pundat的数据框

  ```R
  > library(RODBC)
  > myconn <- odbcConnect("mydsn", uid="Rob", pwd="aardvark")
  > crimedat <- sqlFetch(myconn, Crime)
  > pundat <- sqlQuery(myconn, "select * from Punish")
  > close(myconn)
  > # 这里首先通过一个已注册的数据源名称(mydsn)和用户名(rob)以及密码(aardvark)打开一个ODBC数据库连接。连接字符串并传递给sqlFetch，它将Crime表复制到R数据框crimedat中，然后我们对Punishment执行了SQL语句select并将结果保存到了数据框pundat中，最后关闭连接
  ```

  

  