---
title: R-图形初阶
date: 2019-10-20
updated: 2019-10-20
categories:
- R
- 图形
---

#### 一个简单的例子

```R
> dose <- c(20, 30, 40, 45, 60)
> drugA <- c(16, 20, 27, 40, 60)
> drugB <- c(15, 18, 25, 31, 40)
> plot(dose, drugA, type="b")
```

`plot()`是R中为对象作图的一个泛型函数（它的输出将根据所绘制对象类型的不同而变化）。

上例中，`plot(x, y, type="b")`将x置于横轴，将y置于纵轴，绘制点集(x, y)，然后使用线段将其链接。选项`type="b"`表示同时绘制点和线。

{% asset_img slug 01.jpg %}

#### 图形参数

我们可以通过修改称为图形参数的选项来自定义一幅图形的多个特性（字体、颜色、坐标轴、标题）。

（修改图形参数的）一种方法是通过函数`par()`来指定这些选项。以这种方式设定的参数值，除非再次修改，否则将在会话结束前一直有效。

格式为：`par(optionname=value, optionname=name,...)`。不加参数地执行`par()`将生成一个含有当前图形参数设置的列表。添加参数`no.readonly=TRUE`可以生成一个可以修改的当前图形参数的列表。

```R
> # 使用实心三角作为点的符号，虚线代替实线
> opar <- par(no.readonly = TRUE) # 复制一份当前参数
> par(lty=2, pch=17) # lty=2 把实线改为虚线，pch=17把点改为实心三角
> plot(dose, drugA, type="b")
> par(opar) # 还原初始设置
```

{% asset_img slug 02.jpg %}

指定图形参数的第二种方法是为高级绘图函数直接提供`optionname=value`的键值对。这种情况下，指定的选项仅对这幅图形本身有效。

`plot(dose, drugA, type="b", lty=2, pch=17)`

##### 符号和线条

| 参数 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| pch  | 指定绘制点时使用的符号                                       |
| cex  | 指定符号的大小。cex是一个数值，表示绘图符号相对于默认大小的缩放倍数。默认大小是1, 1.5表示放大为默认值的1.5倍，0.5表示缩小为默认值的50% |
| lty  | 指定线条类型                                                 |
| lwd  | 指定线条宽度。lwd是以默认值的相对大小来表示的（默认值为1）   |

pch可指定的绘图符号如下图：

{% asset_img slug pch图形对应.jpg %}

lty可指定的线条类型：

{% asset_img slug lty-line.jpg %}

##### 颜色

用于指定颜色的参数

| 参数     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| col      | 默认的绘图颜色。某些函数（line和pie）可以接受一个含有颜色值的向量，并自动循环使用。例如，如果设定col=c("red", "blue")并需要绘制三条线，则第一条将为红色，第二条为蓝色，第三条为红色 |
| col.axis | 坐标轴刻度文字的颜色                                         |
| col.lab  | 坐标轴标签(名称)的颜色                                       |
| col.main | 标题的颜色                                                   |
| col.sub  | 副标题的颜色                                                 |
| fg       | 图形的前景色                                                 |
| bg       | 图形的背景色                                                 |

在R中，可以通过颜色下标、颜色名称、十六进制的颜色值、RGB值或HSV值来指定颜色。举例来说，`col=1`、`col="white"`、`col="#FFFFFF`、`col=rgb(1, 1, 1)`和`col=hsv(0, 0, 1)`都是表示白色的等价方式。函数`rgb()`可基于红-绿-蓝三色值生成颜色，而`hsv()`则基于色相-饱和度-亮度来生成颜色。

`colors()`可返回所有可用颜色的名称。

R中也有多种用于创建连续型颜色向量的函数，包括`rainbow()`，`heat.colors()`，`terrain.colors()`，`topo.colors()`，`cm.colors()`。举例来说，`rainbow(10)`可以生成10中连续的”彩虹型“颜色。多阶灰度可使用`gray()`函数生成。这时要通过一个元素值为0和1之间的向量来指定各颜色的灰度。gray(0:10/10)将生成10阶灰度色

```R
> n <- 10
> mycolors <- rainbow(n)
> pie(rep(1,n), labels=mycolors,col=mycolors)
> mygrays <- gray(0:n/n)
> pie(rep(1,n), labels=mygrays, col=mygrays)
```

上述代码运行结果：

{% asset_img slug 03.jpg %}

{% asset_img slug 04.jpg %}

##### 文本属性

用于指定文本大小的参数：

| 参数     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| cex      | 表示相对于默认大小缩放倍数的数值，默认大小为1，1.5表示放大为默认值的1.5倍，0.5表示缩小为默认值的50% |
| cex.axis | 坐标轴刻度文字的缩放倍数，类似cex                            |
| cex.lab  | 坐标轴标签（名称）的缩放倍数，类似cex                        |
| cex.main | 标题的缩放倍数，类似cex                                      |
| cex.sub  | 副标题的缩放倍数，类似cex                                    |

用于指定字体族、字号和字样的参数

| 参数      | 描述                                                         |
| --------- | ------------------------------------------------------------ |
| font      | 整数。用于指定绘图使用的字体样式。1=常规，2=粗体，3=斜体，4=粗斜体，5=符号字体 |
| font.axis | 坐标轴刻度文字的字体样式                                     |
| font.lab  | 坐标轴标签（名称）的字体样式                                 |
| font.main | 标题的字体样式                                               |
| font.sub  | 副标题的字体样式                                             |
| ps        | 字体磅值。文本的最终大小为ps*cex                             |
| family    | 绘制文本时使用的字体族。标准的取值为serif(衬线)，sans(无衬线) |

举例：执行 `par(font.lab=3, cex.lab=1.5, font.main=4, cex.main=2)` 之后创建的所有图形都将拥有斜体、1.5倍于默认文本大小的坐标轴标签（名称），以及粗斜体、2倍于默认文本大小的标题。

在Windows中，可以通过函数windowsFont()来创建字体的映射

```R
> windowsFonts(
+     A=windowsFont("Arial Black"),
+     B=windowsFont("Bookman Old Style"),
+     C=windowsFont("Comic Sans MS")
+ )
```

之后，即可使用A、B、C作为family的取值。

##### 图形尺寸和边界尺寸

用于控制图形尺寸和边界大小的参数

| 参数 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| pin  | 以英寸表示的图形尺寸（宽和高）                               |
| mai  | 以数值向量表示的边界大小，顺序为"下左上右"，单位为英寸       |
| mar  | 以数值向量表示的边界大小，顺序为"下左上右"，单位为英寸。默认值为`c(5, 4, 4, 2) + 0.1` |

代码：`par(pin=c(4, 3), mai=c(1, .5, 1, .2))`可生成一幅4英寸宽、3英寸高、上下边界为1英寸、左边界为0.5英寸、右边界为0.2英寸的图形。

```R
> dose <- c(20, 30, 40, 45, 60)
> drugA <- c(16, 20, 27, 40, 60)
> drugB <- c(15, 18, 25, 31, 40)
> opar <- par(no.readonly = TRUE)
> par(pin=c(2, 3))
> par(lwd=2, cex=1.5)
> par(cex.axis=.75, font.axis=3)
> plot(dose, drugA, type="b", pch=19, lty=2, col="red")
> plot(dose, drugB, type="b", pch=23, lty=6, col="blue", bg="green")
```

{% asset_img slug 05.jpg %}

{% asset_img slug 06.jpg %}

#### 添加文本、自定义坐标和图例

以下代码在图形上添加了标题(main)，副标题(sub)，坐标轴标签(xlab, ylab)并指定了坐标轴范围(xlim, ylim)

```R
> plot(dose, drugA, type="b", col="red", lty=2, pch=2, lwd=2, main="Clinical Trials for DrugA", sub="This is hypothetical data", xlab="Dosage", ylab="Drug Response", xlim=c(0, 60), ylim=c(0, 70))
```

{% asset_img slug 07.jpg %}

##### 标题

`title(main="main title", sub="sub-title", xlab="x-axix label", ylab="y-axis label")`函数中也可以指定其他图形参数。例如下面的代码将生成红色的标题，蓝色的副标题以及叫默认大小小25%的绿色x轴、y轴标签：

`
titile(main="My Title", col.main="red", sub="My Sub-title",col.sub="blue", xlab="My X label", ylab="My Y label", col.lab="green", cex.lab=0.75)
`

##### 坐标轴

`axis(side, at=, labels=, pos=, lty=, col=, las=, tck=, ...)`

坐标轴选项

| 选项   | 描述                                                         |
| ------ | ------------------------------------------------------------ |
| side   | 一个整数，表示在图形的哪边绘制坐标轴(1=下，2=左，3=上，4=右) |
| at     | 一个数值型向量，表示需要绘制刻度线的位置                     |
| labels | 一个字符型向量，表示置于刻度线旁边的文字标签（如果为NULL，则将直接使用at中的值） |
| pos    | 坐标轴线绘制位置的坐标（即与另一条坐标轴相交位置的值）       |
| lty    | 线条类型                                                     |
| col    | 线条和刻度线颜色                                             |
| las    | 标签是否平行于（=0）或者垂直于（=2）坐标轴                   |
| tck    | 刻度线的长度，以相对于绘图区域大小的分数表示表示（负值表示在图形外侧，正值表示在图形内侧，0表示禁用可读，1表示绘制网格线），默认是-0.01 |
| (...)  |                                                              |

```R
> x <- c(1:10)
> y <- x
> z <- 10/x
> opar <- par(no.readonly = TRUE)
> par(mar=c(5, 4, 4, 8) + 0.1)
> plot(x, y, type = "b", pch=21, col='red', yaxt='n', lty=3, ann=FALSE)
Hit <Return> to see next plot: 
Error in plot.new() : figure margins too large
> plot(x, y, type = "b", pch=21, col='red', yaxt='n', lty=3, ann=FALSE)
Hit <Return> to see next plot: return()
> lines(x, z, type="b", pch=22, col="blue", lty=2)
> axis(2, at=x, labels=x, col.axis="red", las=2)
> axis(4, at=z, labels=round(z, digits=2), col.axis="blue", cex.axis=0.7, tck=-.01)
> mtext("y=1/x", side=4, line=3, cex.lab=1, las=2, col="blue")
> title("An Example of Creative Axes", xlab="X values", ylab="Y=X")
```

{% asset_img slug 08.jpg %}

##### 参考线

`abline(h=yvalues, v=xvalues)`

##### 图例

当图形中包含的数据不止一组时，图例可以帮助你辨别出每个条形、扇形或折线各代表哪一类数据。

`legend(location, title, legend, ...)`

- location：指定图例的位置
- title：图例标题的字符串（可选）
- legend：图例标签组成的字符型向量

```R
> dose <- c(20, 30, 40, 45, 60)
> drugA <- c(16, 20, 27, 40, 60)
> drugB <- c(15, 18, 25, 31, 40)
> opar <- par(no.readonly=TRUE)
> par(lwd=2, cex=1.5, font.lab=2) # 增加线条，文本，符号，标签的宽度或大小
> plot(dose, drugA, type="b", pch=15, lty=1, col="red", ylim=c(0, 60), main="Drug A VS. DrugB", xlab="Drug Dosage", ylab="Drug Response") # 绘制图形
> lines(dose, drugB, type="b", pch=17, lty=2, col="blue")

> abline(h=c(30), lwd=1.5, lty=2, col="gray") # 增加次要刻度线
> library(Hmisc)
> minor.tick(nx=3, ny=3, tick.ratio=0.5)
> legend("topleft", inset=.05, title="Drug Type", c("A", "B"), lty=c(1, 2), pch=c(15, 17), col=c("red", "blue")) # 添加图例
```

{% asset_img slug 09.jpg %}

##### 文本标注

可以通过`text()`和`mtext()`将文本添加到图形上。

text()可向绘图区域内部添加文本，而mtext()则向图形的四个边界之一添加文本。

格式：

- `text(location, "text to place", pos, ...)`
- `mtext("text to place", side, line=n, ...)`

```R
> attach(mtcars)
> plot(wt, mpg,
       main="Mileage vs. Car Weight",
       xlab="Weight", ylab="Mileage",
       pch=18, col="blue")
> text(wt, mpg,
       row.names(mtcars),
       cex=0.6, pos=4, col="red"
      )
> detach(mtcars)
```

这里我们针对数据框mtcars提供的32中车型的车重和每加仑汽油行驶英里数绘制了散点图。函数text()被用来在各个数据点右侧添加车辆型号。各点的标签大小被缩小了 40%，颜色为红色。

下面展示不同字体族的代码（需要注意的是，不同平台显示的字体效果不同）：

```R
> opar <- par(no.readonly=TRUE)
> par(cex=1.5)
> plot(1:7,, 1:7, type="n")
> text(3, 3, "Example of default text")
> text(4, 4, family="mono", "Example of mono-spaced text")
> text(5, 5, family="serif", "Example of serif text")
```

#### 图形的组合

在R中使用函数`par()`或`layout()`可以容易地组合多幅图形为一幅总括图形。

可以在`par()`中使用图形参数`mfrow=c(nrows, ncols)`来创建按行填充的、行数为nrows、列数为ncols的图形矩阵。

另外可以使用`nfcol=c(nrows, ncols)`按列填充矩阵。

例如：下面代码创建了四副图形并排布在两行两列中：

```R
> attach(mtcars)
> opar <- par(no.readonly=TRUE)
> par(mfrow=c(2, 2))
> plot(wt, mpg, main="Scatterplot of wt vs. mpg")
> plot(wt, disp, main="Scatterplot of wt vs disp")
> hist(wt, main="Histogram of wt")
> boxplot(wt, main="Boxplot of wt")
> par(opar)
> detach(mtcars)
```

{% asset_img slug 10.jpg %}

下面代码：三行一列排布三幅图形

**注意：**`hist()` 包含一个默认的标题（使用main=""可以禁用它，抑制使用ann=FALSE来禁用所有标题和标签）

```R
> attach(mtcars)
> opar <- par(no.readonly=TRUE)
> par(mfrow=c(3, 1))
> hist(wt)
> hist(mpg)
> hist(disp)
> par(opar)
> detach(mtcars)
```

{% asset_img slug 11.jpg %}

函数`layout()`的调用形式为`layout(mat)`，其中mat是一个矩阵，它指定了所要的组合的多个图形的所在位置，以下代码中，一幅图被置于第一行，另两幅被置于第二行

```R
> attach(mtcars)
> layout(matrix(c(1, 1, 2, 3), 2, 2, byrow=TRUE))
> hist(wt)
> hist(mpg)
> hist(disp)
> detach(mtcars)
```

{% asset_img slug 12.jpg %}