---
title: mysql组合查询
date: 2019-12-19
tags:
- 数据库
- 后端
- mysql
categories:
- 数据库
- mysql
---

#### 使用UNION

多数`SQL`查询都只包含一个或多个表中返回数据的单条`SELECT`语句。`MySQL`也允许执行多个查询(多条`SELECT`语句)，并将结果作为单个查询结果集返回。这些组合查询通常称为并(`union`)

有两种情况需要使用组合查询：

- 在单个表查询中从不同的表返回类似结构的数据；
- 对单个表执行多个查询，按单个查询返回数据。

<!--more-->

组合查询和多个`WHERE`条件：多数情况下，组合相同表的两个查询完成的工作与具有多个WHERE子句条件的单条查询完成的工作相同。

可用`UNION`操作符来组合数条`SQL`查询，所需要做的就是给出每条`SELECT`语句，在各条语句之间放上关键字`UNION`

例如：

​	假设需要价格小于等于5的所有物品的一个列表，而且还想包括供应商1001和1002生产的所有物品，当然可以利用`WHERE`子句来完成，不过这里我们使用`UNION`

- 这里是两条语句的组合

  `SELECT vend_id, prod_id, prod_price FROM products WHERE prod_price <= 5;`

  <img src="http://silencew.cn/uploads/blog/1576736299670.png" style="zoom: 80%;" />

  `SELECT vend_id, prod_id, prod_price FROM products WHERE vend_id IN (1001, 1002);`

  <img src="http://silencew.cn/uploads/blog/1576736376257.png" style="zoom:80%;" />

- 可以使用下面的语句

  `SELECT vend_id, prod_id, prod_price FROM products WHERE prod_price <= 5 UNION SELECT vend_id, prod_id, prod_price FROM products WHERE vend_id IN (1001, 1002);`

  <img src="http://silencew.cn/uploads/blog/1576736514904.png" style="zoom:80%;" />

- 同样，可以使用`WHERE`子句

  `SELECT vend_id, prod_id, prod_price FROM products WHERE prod_price <= 5 OR vend_id IN (1001, 1002);`

#### UNION规则

- UNION必须由两条或两条以上的`SELECT`语句组成，语句之间用关键字`UNION`分隔
- UNION中的每个查询必须包含相同的列、表达式或聚集函数（各个列不需要以相同的次序列出）
- 列数据烈性必须兼容：类型不必完全相同，但必须是DBMS可以隐含地转换的类型（不同数值类型或不同的日期类型）

#### 包含或取消重复的行

UNION会从查询的结果集中自动去除重复的行，如果想返回所有匹配行，可使用`UNION ALL`

`SELECT vend_id, prod_id, prod_price FROM products WHERE prod_price <= 5 UNION ALL SELECT vend_id, prod_id, prod_price FROM products WHERE vend_id IN (1001, 1002);`

<img src="http://silencew.cn/uploads/blog/1576737338677.png" style="zoom:80%;" />

#### 对组合查询结果排序

SELECT语句的输出用`ORDER BY`子句排序，在用`UNION`组合查询时，只能使用一条`ORDER BY`子句。它必须出现在最后一条`SELECT`语句之后。不允许使用多条`ORDER BY`子句。

`SELECT vend_id, prod_id, prod_price FROM products WHERE prod_price <= 5 UNION SELECT vend_id, prod_id, prod_price FROM products WHERE vend_id IN (1001, 1002) ORDER BY vend_id, prod_price;`

<img src="http://silencew.cn/uploads/blog/1576737782438.png" style="zoom:80%;" />



