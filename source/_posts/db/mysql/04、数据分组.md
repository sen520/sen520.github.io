---
title: mysql数据分组
date: 2019-12-13
tags:
- 数据库
- 后端
- mysql
categories:
- 数据库
- mysql
---

### 创建分组

分组是在SELECT语句中的GROUP BY 子句中建立的。

例：

`SELECT vend_id, COUNT(*) AS num_prods FROM products GROUP BY vend_id;`

![](https://silencew.cn/uploads/1576208076595.png)

<!--more-->

GROUP BY

- GROUP BY子句可以包含任意数目的列，这使得能对分组进行嵌套，为数据分组提供更细致的控制。
- 如果在GROUP BY子句中嵌套了分组，数据将在最后规定的分组商家进行汇总。换句话说，在建立分组时，指定的所有列都一起计算。（所有不能从个别的列取回数据）。
- GROUP BY子句中列出的每个列都必须是检索列或有效的表达式（但不能是聚集函数）。如果在SELECT中使用表达式，则必须在GROUP BY子句中指定相同的表达式，不能使用别名
- 除聚集计算语句外，SELECT语句中的每个列都必须在GROUP BY子句中给出。
- 如果分组列中具有NULL值，则NULL将作为一个分组返回。如果列中有多行NULL值，他们将分为一组。
- GROUP BY子句必须出现在WHERE子句之后，ORDER BY 子句之前。

### 过滤分组

如果想要列出至少有两个订单的所有骨科，这样的数据就必须基于完整的分组而不是个别的行进行过滤。

可以使用HAVING

`SELECT cust_id, COUNT(*) AS orders FROM orders GROUP BY cust_id HAVING COUNT(*) >= 2;`

![](https://silencew.cn/uploads/1576208780736.png)

HAVING和WHERE的差别，WHERE在数据分组前进行过滤，HAVING在分组后进行过滤。当然，两个也可以在同一条语句中出现。

列出具有2个（含）以上、价格为10（含）以上的产品的供应商

`SELECT vend_id, COUNT(*) AS num_prods FROM products WHERE prod_price >= 10 GROUP BY vend_id HAVING COUNT(*) >= 2;`

![](https://silencew.cn/uploads/1576209189512.png)

列出具有两个至上的产品的供应商

`SELECT vend_id, COUNT(*) AS num_prods FROM products GROUP BY vend_id HAVING COUNT(*) >= 2;`

![](https://silencew.cn/uploads/blog/1576459642113.png)

### 分组和排序

| ORDER BY                             | GROUP BY                                                 |
| ------------------------------------ | -------------------------------------------------------- |
| 排序产生的输出                       | 分组行。但输出可能不是分组的顺序                         |
| 任意列都可以使用（非选择的列也可以） | 只可能使用选择列或表达式列，而且必须使用每个选择列表达式 |
| 不一定需要                           | 如果与聚集函数一起使用列（表达式），则必须使用           |

检索总计订单价格大于等于50的订单的订到号和总计订单价格

`SELECT order_num, SUM(quantity*item) AS ordertotal FROM orderitems GROUP BY order_num HAVING SUM(quantity*item_price) >= 50;`

![](https://silencew.cn/uploads/blog/1576468460944.png)

如果按总计订单价格排序输出

`SELECT order_num, SUM(quantity * item_price) AS ordertotal FROM orderitems GROUP BY order_num HAVING SUM(quantity * item_price) >= 50 ORDER BY ordertotal;`

![](https://silencew.cn/uploads/blog/1576491067581.png)

SELECT子句的顺序

| 子句     | 说明               | 是否必须使用           |
| -------- | ------------------ | ---------------------- |
| SELECT   | 要返回的列或表达式 | 是                     |
| FROM     | 从中检索数据的表   | 仅在从表选择数据时使用 |
| GROUP BY | 分组说明           | 仅在按组计算聚集时使用 |
| WHERE    | 行级过滤           | 否                     |
| HAVING   | 组级过滤           | 否                     |
| ORDER BY | 输出排序顺序       | 否                     |
| LIMIT    | 要检索的行数       | 否                     |

